# The evolution of burrowing, parental care, and egg investment in freshwater crayfish:
Authors: Zackary A. Graham, Zachary Loughman, Alexandre V. Palaoro 
Contact about code and analyses: alexandre.palaoro@gmail.com
---

### This readme has been divided in three parts. First, we will talk about file structure, then the code, the dataset.

##### File structure:

We made three types of analyses. 
Two analyses use reversible-jump MCMC to test the magnitude and location of shifts in evolutionary optima across the phylogeny. Given the use of Bayesian MCMC implementations, these two analyses have two types of code: one to run in a cluster and generate the mcmc chains and stepstone analysis, and another code to parse the information from these chains. The two folders that contain all files required to run these analyses are the "clutch_size" and "egg_size" folders. In them, you will find the parsing code and each code used in a cluster. You will also find three folders inside: "data", "figures", and "results_mcmc". "data" contains the data files and the phylogeny. "figures" is a folder that receives the figures made in R. "results_mcmc" contains the chains and stepstones generated by the Bayesian analysis performed in a cluster. We are providing all the resulting files so you do not have to run them. You can load the chains and proceed with the analyses as you wish.

The third type of analyses relates to a phylogeneletic linear regression and ancestral state reconstructions. In it, you will have the "data" and "figures" folder that save the same function as before. You will also find two codes: "tree_vis_file.R" and "pgls-run.R". The first is the code we used to build most of the phylo figures in the paper. The second file is the code for all the ancestral state reconstruction and pgls we present in the paper and supplementary files. 

##### Code:

The code was made to be ran in a cluster and then parsed in a standard computer. All code that starts with "eggsize_", "stepstone_", or "rjmcmc_" were used in the Palmetto cluster (Clemson University) to run the mcmc chains or to perform the stepping stone procedure to calculate the marginal likelihood of the models. Here in GitHub, we are providing all files that are smaller than 25 mb generated in the cluster in the folder "results_mcmc". The files that we were unable to upload were mostly the stepping stone files ("ss_"). Thus, you can run the parsing code to load those objects and chains and perform any sort of data treatment required - the only problem will be calculating the marginal likelihood. But these files can be found in the Zenodo or the Dryad link (I'll post them here afterwards). 

The only exception is the "pgls" folder that contains non-bayesian analyses (for the most part). These can be ran in any computer without necessarily requiring the mcmc chains. However, one of the the ancestral reconstructions was made with bayesian approximation. For those, we provide the RDS files of the chains as well.

##### Dataset:

Dataset contains the average values for each species of crayfish we found information for. All variables are contained in the same file. These data were used to run all analyses contained in the manuscript.

Body length, egg diameter, and number of eggs were all collected from the literature. If we found more than one egg number, we averaged both observations. If we only had a range of values, we also averaged them. The list of papers we used to collect the data are in the excel spreadsheet: "Raw_Data_Supplemental_file.xlsx" 

The phylogenetic tree was taken from: 
Stern, D. B., J. Breinholt, C. Pedraza-Lara, M. López-Mejía, C. L. Owen, H. Bracken-Grissom, J. W. Fetzner, and K. A. Crandall. 2017. Phylogenetic evidence from freshwater crayfishes that cave adaptation is not an evolutionary dead-end. Evolution (N. Y). 71:2522–2532.

METADATA OF LH_data_reorder.csv

In the columns we have the variables, in rows we have the individuals. We obtained mean values by averaging the individuals of the species.

COLUMN A: species - the crayfish species <br>
COLUMN B: genus - the genus the specific species belongs to. based on the phylogeny <br>
COLUMN C: family - the family the crayfish belongs to. based on the phylogeny <br>
COLUMN D: body.size.avg - the average value of body length obtained from the literature. Can be two types of lengths: carapace length or post-orbital carapace length. Unit: cm <br>
COLUMN E: bs.metric - type of body length measurement. Either carapace length (cl) or post-orbital carapace length (ocl) <br>
COLUMN F: fecundity.avg - mean number of eggs attached to the abdomen of a female crayfish <br>
COLUMN G: egg.diam.avg - mean diameter of the eggs attached to the abdomen of a female crayfish. Unit: mm <br>
COLUMN H: notes - any notes about the body size, fecundity or egg diameter data collected from the literature <br>
COLUMN I: burrow.lough - Morphological classification of burrowing status. Levels: Burrower, Non-burrower <br>
COLUMN J: traditional.burrowing.classification - Traditional classification of burrowing status. Levels: Primary burrower, Secondary burrower, Tertiary burrower <br>
COLUMN K: combined.burrowing.classification - Classification that mixes the morphological and traditional classifications. Levels: Semi-terrestrial burrower, Open-water burrower <br>


The code was run in R software v4.2.2.
Packages used:
bayou 2.0 - v2.2.0 - https://github.com/uyedaj/bayou
tidyr - v2.6.2
ape - v5.7-1
geiger - v2.0.10
phytools - v1.5-1
nlme - v3.1.160
scales - v1.2.1
gplots - v3.1.3
phylolm - v2.6.2
plotrix - v3.8-2
foreach - v1.5.2
doParallel - v1.0.17

## Acknowledgment

We thanks the Palmetto cluster at Clemson University for the allotment of computer time. This material is based on work supported by the National Science Foundation under Grant Nos. MRI# 2024205, MRI# 1725573, MRI# 1725573, and CRI# 2010270.
Any opinions, findings, and conclusions or recommendations expressed in this material are those of the author(s) and do not necessarily reflect the views of the National Science Foundation.


## Sharing/access Information

The file structure and files can be seen and downloaded from:


The phylogenetic tree was taken from another paper:
Stern, D. B., J. Breinholt, C. Pedraza-Lara, M. López-Mejía, C. L. Owen, H. Bracken-Grissom, J. W. Fetzner, and K. A. Crandall. 2017. Phylogenetic evidence from freshwater crayfishes that cave adaptation is not an evolutionary dead-end. Evolution (N. Y). 71:2522–2532.
